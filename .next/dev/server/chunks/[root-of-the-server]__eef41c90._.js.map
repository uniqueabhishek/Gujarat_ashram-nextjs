{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///D:/D%20Desktop/Gujarat_Ashram%20Website/Gujarat%20Ashram%20Website%20Wrapper%20Developement/ashram-nextjs/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\nimport path from 'path'\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined\r\n}\r\n\r\n// Construct absolute database path for Windows compatibility\r\nconst dbPath = path.join(process.cwd(), 'prisma', 'dev.db')\r\nconst databaseUrl = `file:${dbPath}`\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    datasources: {\r\n      db: {\r\n        url: databaseUrl\r\n      }\r\n    },\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIxB,6DAA6D;AAC7D,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;AAClD,MAAM,cAAc,CAAC,KAAK,EAAE,QAAQ;AAE7B,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,aAAa;QACX,IAAI;YACF,KAAK;QACP;IACF;IACA,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/D%20Desktop/Gujarat_Ashram%20Website/Gujarat%20Ashram%20Website%20Wrapper%20Developement/ashram-nextjs/app/api/images/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { writeFile, mkdir } from 'fs/promises'\r\nimport { join } from 'path'\r\nimport { prisma } from '@/lib/prisma'\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const formData = await request.formData()\r\n    const file = formData.get('image') as File\r\n    const category = (formData.get('category') as string) || 'general'\r\n\r\n    if (!file) {\r\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 })\r\n    }\r\n\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']\r\n    if (!allowedTypes.includes(file.type)) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid file type. Only JPEG, PNG, GIF, and WebP allowed.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Validate file size (5MB limit)\r\n    const maxSize = 5 * 1024 * 1024\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json(\r\n        { error: 'File too large. Maximum size is 5MB.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Generate unique filename\r\n    const bytes = await file.arrayBuffer()\r\n    const buffer = Buffer.from(bytes)\r\n    const uniqueSuffix = `${Date.now()}-${Math.round(Math.random() * 1e9)}`\r\n    const ext = file.name.split('.').pop()\r\n    const filename = `${uniqueSuffix}.${ext}`\r\n\r\n    // Ensure upload directory exists\r\n    const uploadDir = join(process.cwd(), 'public', 'images')\r\n    await mkdir(uploadDir, { recursive: true })\r\n\r\n    // Write file\r\n    const filePath = join(uploadDir, filename)\r\n    await writeFile(filePath, buffer)\r\n\r\n    // Get current max order\r\n    const maxOrder = await prisma.siteImage.findFirst({\r\n      where: { category },\r\n      orderBy: { order: 'desc' },\r\n      select: { order: true },\r\n    })\r\n\r\n    // Save to database\r\n    const image = await prisma.siteImage.create({\r\n      data: {\r\n        category,\r\n        filename,\r\n        path: `/images/${filename}`,\r\n        order: (maxOrder?.order || 0) + 1,\r\n      },\r\n    })\r\n\r\n    return NextResponse.json(image)\r\n  } catch (error) {\r\n    console.error('Upload error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to upload image' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,WAAW,AAAC,SAAS,GAAG,CAAC,eAA0B;QAEzD,IAAI,CAAC,MAAM;YACT,OAAO,uNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,qBAAqB;QACrB,MAAM,eAAe;YAAC;YAAc;YAAa;YAAa;YAAa;SAAa;QACxF,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,uNAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4D,GACrE;gBAAE,QAAQ;YAAI;QAElB;QAEA,iCAAiC;QACjC,MAAM,UAAU,IAAI,OAAO;QAC3B,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,uNAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,eAAe,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM;QACvE,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QACpC,MAAM,WAAW,GAAG,aAAa,CAAC,EAAE,KAAK;QAEzC,iCAAiC;QACjC,MAAM,YAAY,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI,UAAU;QAChD,MAAM,IAAA,8HAAK,EAAC,WAAW;YAAE,WAAW;QAAK;QAEzC,aAAa;QACb,MAAM,WAAW,IAAA,yGAAI,EAAC,WAAW;QACjC,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,wBAAwB;QACxB,MAAM,WAAW,MAAM,gMAAM,CAAC,SAAS,CAAC,SAAS,CAAC;YAChD,OAAO;gBAAE;YAAS;YAClB,SAAS;gBAAE,OAAO;YAAO;YACzB,QAAQ;gBAAE,OAAO;YAAK;QACxB;QAEA,mBAAmB;QACnB,MAAM,QAAQ,MAAM,gMAAM,CAAC,SAAS,CAAC,MAAM,CAAC;YAC1C,MAAM;gBACJ;gBACA;gBACA,MAAM,CAAC,QAAQ,EAAE,UAAU;gBAC3B,OAAO,CAAC,UAAU,SAAS,CAAC,IAAI;YAClC;QACF;QAEA,OAAO,uNAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,uNAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}